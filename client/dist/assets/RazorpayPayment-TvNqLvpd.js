import{x as z,r as u,u as R,a as b,p as k,d as j,j as m,w as C,t as P,v as D,q as S}from"./index-U6pLF9IQ.js";import{l as E}from"./index-CUx-uIXr.js";var v={},N=z&&z.__awaiter||function(p,t,a,r){function n(o){return o instanceof a?o:new a(function(e){e(o)})}return new(a||(a=Promise))(function(o,e){function s(i){try{c(r.next(i))}catch(l){e(l)}}function d(i){try{c(r.throw(i))}catch(l){e(l)}}function c(i){i.done?o(i.value):n(i.value).then(s,d)}c((r=r.apply(p,t||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});const _=u;class M{constructor(t){this.options=t,typeof window<"u"&&(this.rzrpayInstannce=new window.Razorpay(this.options))}on(t,a){this.rzrpayInstannce.on(t,a)}open(){this.rzrpayInstannce.open()}}const O=()=>{const p="https://checkout.razorpay.com/v1/checkout.js",t=(0,_.useMemo)(()=>typeof window<"u",[]),[a,r]=(0,_.useState)(!1),n=(0,_.useCallback)(()=>!(!t||!("Razorpay"in window)),[]),o=(0,_.useCallback)(e=>{if(t)return new Promise((s,d)=>{const c=document.createElement("script");c.src=e,c.onload=i=>{r(!0),s(i)},c.onerror=i=>d(i),document.body.appendChild(c)})},[]);return(0,_.useEffect)(()=>{n()||N(void 0,void 0,void 0,function*(){try{yield o(p)}catch(e){throw new Error(e)}})},[]),[M,a]};var T=v.default=O;const F=()=>{const p=R(),{user:t}=b(l=>l.userAuth),a=k(),r=u.useRef(null);u.useEffect(()=>{r.current=E("ws://localhost:3000")},[]);const{form:n,planId:o,mentorId:e,planAmount:s}=b(l=>l.applySlice),d=j(),[c]=T(),i=u.useCallback(()=>{const l={key:"rzp_test_b79hbKESuzK5D3",amount:parseInt((s==null?void 0:s.plan_amount)||"0",10)*100,currency:"INR",name:"Bright Route",description:"Test Transaction",image:"https://t3.ftcdn.net/jpg/02/17/18/84/360_F_217188426_smgwnDFnQC5DHQ8mKGkdsMO7oDDP5nZn.jpg",handler:g=>{(async()=>{var y,f;try{const h={razorPay_id:g.razorpay_payment_id,mentor_id:e==null?void 0:e.mentor_id,mentor_plan_id:o==null?void 0:o.mentor_plan_id,mentee_id:t==null?void 0:t._id,mentor_plan_amount:s==null?void 0:s.plan_amount,goal_of_mentorship:n==null?void 0:n.mentorship_goal,time_to_reach_goal:n==null?void 0:n.time_to_reach,message_to_mentor:n==null?void 0:n.message_to_mentor};if((await d.post("/payment-suceess",h,{withCredentials:!0})).data.status==="success"){const w="Payment Completed Successfully!ðŸ¤ðŸ¤",x=`${t==null?void 0:t.first_name} has purchased your mentorship plan!ðŸŽ‰`;await d.post("/notification/paymentMessage",{text:w},{withCredentials:!0}),await d.post(`/notification/mentorNotification/${e==null?void 0:e.mentor_id}`,{mentorText:x},{withCredentials:!0}),(y=r.current)==null||y.emit("sendNotification",{senderId:t==null?void 0:t._id,receiverId:t==null?void 0:t._id,content:w,type:"mentee"}),(f=r.current)==null||f.emit("sendNotification",{senderId:t==null?void 0:t._id,receiverId:e==null?void 0:e.mentor_id,content:x,type:"mentor"}),a(C(null)),a(P(null)),a(D(null)),a(S(null)),p(`/mentor-profile/apply/checkout/success/${e==null?void 0:e.mentor_id}`)}}catch(h){console.log(h)}})()},prefill:{mentee_id:t==null?void 0:t._id,name:t==null?void 0:t.first_name,email:t==null?void 0:t.email},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"}};new c(l).open()},[c,d,a,n==null?void 0:n.mentorship_goal,n==null?void 0:n.message_to_mentor,n==null?void 0:n.time_to_reach,e==null?void 0:e.mentor_id,p,s==null?void 0:s.plan_amount,o==null?void 0:o.mentor_plan_id,t==null?void 0:t._id,t==null?void 0:t.email,t==null?void 0:t.first_name]);return m.jsx("div",{className:"w-full h-screen flex justify-center items-center",children:m.jsx("button",{onClick:i,className:"border px-6 py-2 text-white bg-black",children:"Make Payment"})})},Z=()=>m.jsx("div",{children:m.jsx(F,{})});export{Z as default};
